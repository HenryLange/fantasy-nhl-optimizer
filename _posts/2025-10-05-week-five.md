---
title: "Week 5: Advanced Drafts and Custom Score Weighting"
date: 2025-10-05
---

Last week, I finally started to use lpSolve with roster restrictions to make optimal teams based on the conditions. I tested this with five different simulations where I randomly took 30% of the NHL's players out of the table and saw how lpSolve reacted, and if it still made the best team possible. While that was a great step, it wasn't totally accurate for a real draft. That's why my first goal this week was to simulate a more realistic draft.

---

### Advanced draft
As I started this section of the code, I based it on what I had from last week's draft simulations. However, I soon realized that this different form of a draft, where I would pick, then I'd eliminate the top n number of players (n being the number of other players in the league), actually didn't involve lpSolve. Instead, this form of a draft was completed using a lot of `ifelse` statements. 
```
 # check if pick satisfies position requirements or if he can go to the bench
    if (pos %in% names(counts) && counts[[pos]] < req_counts[[pos]]) {
      drafted_team <- bind_rows(drafted_team, best_pick)
      counts[[pos]] <- counts[[pos]] + 1
    } else if (counts$Bench < req_counts["Bench"]) {
      drafted_team <- bind_rows(drafted_team, best_pick)
      counts$Bench <- counts$Bench + 1
    }
```

This section of code shows what, in my opinion, was the most challenging thing I had to do to simulate a draft like this. This code essentially checks if the player with the highest projected points has a position that isn't already full on my roster. If it isn't, the player is selected, and it moves on to the next pick. If the player's position is full, then the code checks if the player can go to the bench and take a spot there. This code, combined with more that isn't shown, allows the roster to satisfy requirements while taking players with the highest projected points, while simultaneously removing a number of players corresponding to the number of players in the league. This last step is shown below: 

```
 # remove the drafted player and top n others that have been taken
    pool <- pool %>% arrange(desc(Proj_fantasy_points)) %>% 
      slice(-(1:(remove_top_n+1)))
```
 
---

### Testing the New Draft Simulation
As I have done in my previous weeks with functions I make, I have to test this. I decided to initially create 3 teams.
```
advanced_team_1 <- simulate_draft_advanced(all_players, remove_top_n = 7, total_players = 16)
advanced_team_1
advanced_team_2 <- simulate_draft_advanced(all_players, remove_top_n = 9, total_players = 16)
advanced_team_2
advanced_team_3 <- simulate_draft_advanced(all_players, remove_top_n = 11, total_players = 16)
advanced_team_3
```
The only thing that changes in my teams is "remove_top_n," which simply means the number of players that are removed from the table after I pick one. It removes the top players because, in a draft, we should assume the other league members will take the best player available. The first league simulates a league with myself and 7 others, the second simulates one with myself and 9 others, and the third simulates one with myself and 11 others. 

I made a visual to compare the projected points for these teams, and the results were noticeable, but not to the extent I wanted. I decided to add a fourth team with myself and 19 other players. This size league is common for a youth hockey team of 20 players who all want to be in a fantasy league together, so that's why I chose that number.

After adding those 4 teams, here's the visual I made:

![advanced_team_proj_totals_plot]({{ site.baseurl }}/assets/images/advanced_team_proj_totals_plot.png)

We can see that as more players are removed from the table with each pick, the number of good players I can get decreases, and my overall projected points fall as more people join the league.

---

### THE TOOL
Throughout all of these weeks, I have been cleaning data, visualizing, and optimizing all for one reason. To end with a finished tool that can assist in the drafting of a fantasy hockey team. Yes, the ESPN app has projected player points, and yes, I'm sure other projections may exist. One thing I want to make unique about my tool, however, is that one can enter the different rules, scoring systems, or restrictions of their league, and the best projected players/points would change with what they enter. Also, I think it would be cool to let users enter a player that was taken, and that player will be taken out of the list for them to select. This is important because in a draft, other people in a league can make all sorts of decisions on players, and it would be very helpful to have a way to account for this and project the best remaining team.

Completing a tool like this requires me to venture out of my RStudio; however, I will still be using R. For that reason, I began the preparation for this tool this week.

---

### Custom Scoring System
One of the biggest things that can change from league to league in fantasy hockey is the scoring system. I based the scoring system in previous weeks on a very common one, but hockey players love to experiment with different scoring systems based on what they believe matters in hockey or what can give them the best chance to win. For this reason, I created functions in which one could enter custom weights, and the projected fantasy points would change with them. 
```
project_goalies_points_FOR_TOOL <- function(draftable_goalies_FOR_TOOL, weight_W = 3, weight_GA = -1, weight_saves = 0.2, weight_shutouts = 2) {
  draftable_goalies_FOR_TOOL %>% 
    mutate(
      projected_fantasy_points_FOR_TOOL = 
        (weight_W  * (ifelse(!is.na(W), W, 0))) +
        (weight_GA  * (ifelse(!is.na(GA), GA, 0))) +
        (weight_saves * (ifelse(!is.na(saves), saves, 0))) +
        (weight_shutouts * (ifelse(!is.na(shutouts), shutouts, 0)))
     ) 
}
```
This is my fantasy point projection function for goalies. Basically, when I make the tool later, the numbers the user enters will be filled in for the "weight_W" or "weight_GA," for example, and this will go into the formula that calculates projected points. The function for players looks similar, except it is a little longer and involves stats like goals, assists, shots, blocks, etc.

---

### Testing the Functions
As always...I had to test that these work. So, I entered some weights. In the goalie function, I did very high weights, expecting goalies to have projections upwards of the thousands. For skaters, I did very small weights, expecting projections that might be shy of 100 points. This is what that looked like:
```
# test goalie function with some very pumped up weights
test_goalie_projection = project_goalies_points_FOR_TOOL(draftable_goalies_FOR_TOOL, weight_W = 5, weight_GA = -2, weight_saves = 1, weight_shutouts = 5)
# test player function with some very small weights
test_skater_projection = project_skaters_points_FOR_TOOL(draftable_players_FOR_TOOL, weight_G = 1, weight_A = 0.5, weight_SOG = 0.1, weight_BLK = 0.05, weight_PPG = 0.25, weight_PPA = 0.25, weight_SHG = 0.067, weight_SHA = 0.41)
```
Then, I wanted to take a look at the top 20 resulting goalies and skaters. Here they are.

Goalies:

|player               | projected_fantasy_points_FOR_TOOL|
|:--------------------|---------------------------------:|
|Connor Hellebuyck    |                              1564|
|Andrei Vasilevskiy   |                              1528|
|Filip Gustavsson     |                              1434|
|Igor Shesterkin      |                              1415|
|Ilya Sorokin         |                              1391|
|Jake Oettinger       |                              1360|
|Sam Montembeault     |                              1356|
|Mackenzie Blackwood  |                              1298|
|Joey Daccord         |                              1291|
|Dustin Wolf          |                              1289|
|Lukáš Dostál         |                              1271|
|Jeremy Swayman       |                              1234|
|Juuse Saros          |                              1211|
|Karel Vejmelka       |                              1207|
|Elvis Merzļikins     |                              1188|
|Jordan Binnington    |                              1177|
|Sergei Bobrovsky     |                              1175|
|Darcy Kuemper        |                              1146|
|Ukko-Pekka Luukkonen |                              1112|
|Adin Hill            |                              1110|

Players:

|player           | projected_fantasy_points_FOR_TOOL|
|:----------------|---------------------------------:|
|Nikita Kucherov  |                           118.650|
|Nathan MacKinnon |                           118.400|
|David Pastrňák   |                           113.350|
|Leon Draisaitl   |                           112.600|
|Kyle Connor      |                           105.134|
|Cale Makar       |                           101.294|
|William Nylander |                            98.650|
|Jack Eichel      |                            96.027|
|Zach Werenski    |                            95.987|
|Artemi Panarin   |                            93.750|
|Sidney Crosby    |                            93.400|
|Brandon Hagel    |                            92.891|
|Sam Reinhart     |                            92.645|
|Clayton Keller   |                            92.550|
|Mitch Marner     |                            92.527|
|Auston Matthews  |                            92.434|
|Jake Guentzel    |                            91.867|
|Connor McDavid   |                            91.250|
|Brayden Point    |                            90.900|
|Filip Forsberg   |                            90.700|

Like I expected, the top goalie had over 1500 points, and the players were slightly above my predictions, with the top player at 118.65 points. I also think it's important to note how, when weights change, so does the order of the top players. This matters because when players enter their league's scoring system into the tool, the best players to pick will change and really be unique to every scoring system.

---

### What’s next?
Like I mentioned before, I will now be focusing my work on the tool I want to finish, hopefully by next week if all goes to plan. This means taking what I did at the end of this week and making an interactive page for users to customize depending on their league and get projections with. In the same way I made a function for player and goalie projections based on weights, next week I expect I will have to make more functions for the optimization and other things that may change from league to league. 

You can see my code for this week in the [code](https://henrylange.github.io/fantasy-nhl-optimizer/code/) section.

I'm closing in on a final product! I am confident that what I have learned in the past 5 weeks has laid the right foundation for this tool to be made well, and hopefully result in many others and me having great results in the upcoming fantasy hockey season. 
